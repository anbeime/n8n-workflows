{
  "name": "åµŒå¥—å®ç°å¯¹è¯å†…åŠ å›¾è¡¨",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -320,
        -180
      ],
      "id": "c11ab58f-c1cd-4d8c-b08c-5e576a3a7e6e",
      "name": "When clicking â€˜Test workflowâ€™"
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "ä½ å¥½æˆ‘æ˜¯ä½ çš„AIæ•°æ®åº“å°åŠ©æ‰‹ï¼Œè¯·å‘Šè¯‰æˆ‘ä½ æƒ³æŸ¥è¯¢çš„æ•°æ®ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›è§£é‡Šï¼Œç”ŸæˆSQLä»£ç ï¼Œè¿”å›æ•°æ®è¡¨æ ¼ä»¥åŠä¸ºæ‚¨ç”»å‡ºç›¸åº”çš„å›¾è¡¨ã€‚",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -320,
        20
      ],
      "id": "ec2a2fa8-727c-44d4-bd7a-b04ac390aa3d",
      "name": "When chat message received",
      "webhookId": "5e905399-2b27-4350-b928-46cc8ad0f4af"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ª AI åŠ©æ‰‹ï¼Œä¸“é—¨è§£æ SQL æŸ¥è¯¢è¿”å›çš„ Markdown è¡¨æ ¼ï¼Œå¹¶ç”Ÿæˆæ•°æ®å¯è§†åŒ–å›¾è¡¨çš„ JSON é…ç½®ã€‚\n\n### ğŸ“Š SQL ç»“æœï¼ˆMarkdown æ ¼å¼ï¼‰ï¼š\n\n{{ $json.output }}\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=\n### **ä½ çš„ä»»åŠ¡**\n1. **è§£æ SQL æŸ¥è¯¢ç»“æœ**ï¼š\n   - **ç¬¬ä¸€è¡Œæ˜¯åˆ—å**\n   - **åç»­æ˜¯æ•°æ®ï¼Œæ¯åˆ—ç”± '|' åˆ†éš”**\n2. **åˆ†ææ•°æ®ï¼Œé€‰æ‹©æœ€ä½³ X è½´ã€Y è½´**ï¼š\n   - **X è½´ åº”è¯¥æ˜¯ç±»åˆ«å­—æ®µï¼ˆæ–‡æœ¬æˆ–æ—¥æœŸï¼‰**\n   - **Y è½´ åº”è¯¥æ˜¯æ•°å€¼å­—æ®µï¼ˆé”€å”®é¢ã€æ•°é‡ç­‰ï¼‰**\n3. **å†³å®šæœ€é€‚åˆçš„å›¾è¡¨ç±»å‹**ï¼š\n   - **æŸ±çŠ¶å›¾ï¼ˆbarï¼‰**ï¼šå¦‚æœ X è½´æ˜¯ç±»åˆ«ï¼ŒY è½´æ˜¯æ•°å€¼\n   - **æŠ˜çº¿å›¾ï¼ˆlineï¼‰**ï¼šå¦‚æœ X è½´æ˜¯æ—¥æœŸ\n   - **é¥¼å›¾ï¼ˆpieï¼‰**ï¼šå¦‚æœæ•°æ®é€‚ç”¨äºåˆ†ç±»å æ¯”\n4. **è¿”å› JSON æ ¼å¼çš„ QuickChart é…ç½®**ï¼š\n```json\n{\n  \"chart_type\": \"bar\",\n  \"x_axis\": \"selected_column_for_x\",\n  \"y_axis\": \"selected_column_for_y\",\n  \"chartConfig\": {\n    \"type\": \"bar\",\n    \"data\": {\n      \"labels\": [\"X1\", \"X2\", \"X3\"],\n      \"datasets\": [\n        {\n          \"label\": \"Y Label\",\n          \"data\": [value1, value2, value3],\n          \"backgroundColor\": \"rgba(54, 162, 235, 0.6)\"\n        }\n      ]\n    },\n    \"options\": {\n      \"responsive\": true\n    }\n  }\n}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        120,
        120
      ],
      "id": "241a27e3-36c5-45dc-babb-94d931cc72ce",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c7df66bc-a9ca-42d6-8957-0fa973818499",
              "name": "response",
              "value": "={{ \"https://quickchart.io/chart?width=400&height=300&c=\" + encodeURIComponent(JSON.stringify($json.output.chartConfig)) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        460,
        120
      ],
      "id": "1a9b410f-e461-4641-86c6-f9926e2de136",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"chart_type\": [\"bar\", \"line\", \"pie\", \"mixed\"],\n  \"x_axis\": [\"string\", \"null\"],  \n  \"y_axis\": [\"string\", \"number\", \"null\"],\n  \"chartConfig\": {\n    \"type\": [\"bar\", \"line\", \"pie\", \"mixed\"],\n    \"data\": {\n      \"labels\": [\"string\", \"null\"],  \n      \"datasets\": [\n        {\n          \"label\": \"string\",\n          \"data\": [\"number\", \"string\",\"null\"],  \n          \"backgroundColor\": [\"string\", \"null\"],  \n          \"borderColor\": [\"string\", \"null\"],\n          \"yAxisID\": [\"string\", \"null\"]\n        }\n      ]\n    },\n    \"options\": {\n      \"responsive\": [\"boolean\", \"null\"],\n      \"spanGaps\": true\n    }\n  }\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        280,
        300
      ],
      "id": "af8b2be6-8324-4921-b158-70b7fcd145e2",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        740,
        40
      ],
      "id": "9e45382e-98eb-46a5-abcf-47173863caa7",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5bb7e445-bc25-40a2-b5ae-0861b10d6491",
              "name": "output",
              "value": "={{ $json.output }}  \n\n \n![Chart]({{ $json.response}})",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        900,
        40
      ],
      "id": "1d3287f5-8b40-4c2b-adf5-71f90266ca53",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "l2NTBBMlHtUsGXh2",
          "mode": "list",
          "cachedResultName": "å­SQLæµç¨‹"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        -100,
        20
      ],
      "id": "de4ba13c-8c2c-4988-8468-afb503b498e1",
      "name": "å­SQLæµç¨‹"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "jiJrnYg9UN6vmMKV",
          "mode": "list",
          "cachedResultName": "ä¸€æ¬¡æ€§æ‰§è¡Œéƒ¨åˆ†å­æµç¨‹"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        -100,
        -180
      ],
      "id": "fe551736-1a32-4846-847c-46e2b4a197d7",
      "name": "ä¸€æ¬¡æ€§æ‰§è¡Œéƒ¨åˆ†å­æµç¨‹"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "deepseek-chat",
          "mode": "list",
          "cachedResultName": "deepseek-chat"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        120,
        320
      ],
      "id": "a48d87d9-3743-417e-8e20-b223bf5ea70c",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "SiPDeXHnu5Fl2v4t",
          "name": "Deepseek"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Test workflowâ€™": {
      "main": [
        [
          {
            "node": "ä¸€æ¬¡æ€§æ‰§è¡Œéƒ¨åˆ†å­æµç¨‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "å­SQLæµç¨‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å­SQLæµç¨‹": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "22d53bb5-8b10-47cd-9f12-62b6c788a8b4",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "1fc85153dfc4ea22a8172f0d7347fa9f591f71e2064dc331f7bdc1d7ee422e7a"
  },
  "id": "tzdx3UYIX8vGpQiN",
  "tags": [
    {
      "createdAt": "2025-02-25T10:55:04.069Z",
      "updatedAt": "2025-02-25T10:55:04.069Z",
      "id": "KUfSxWPdWLM64AbD",
      "name": "åµŒå¥—æ–¹æ³•å®ç°chatå†…åŠ å›¾æ ‡"
    }
  ]
}